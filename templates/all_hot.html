<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 引入外部CSS文件 -->
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- 引入JavaScript文件 -->
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/main.js"></script>
    </head>
<body>
    <div class="container">

        

        <!-- 移除重复的搜索框 -->
        <div class="table-container">
            <!-- 头部容器 - 包含日期选择器和文字提示 -->
            <div class="header-container">
                <div class="date-selector">
                    <span class="market-label">
                        <span style="color: orange;">橙色字体【创业板】</span> <span style="color: rgba(60, 127, 250, 0.781);">蓝色字体【科创板】</span>
                    </span>
                    <span style="color: var(--text-color);"> | </span>
                    <input type="date" id="dateFilter" placeholder="选择日期" onchange="filterByDate(this.value)" class="filter-input">
                    <span style="color: var(--text-color);"> | </span>
                    <a href="/all_hot" style="color: white !important; text-decoration: none !important; font-size: 14px;">所有股票同列</a>
                    <span style="color: var(--text-color);"> | </span>
                    <a href="/" style="color: white !important; text-decoration: none !important; font-size: 14px;">按题材同列</a>
                    <div style="margin-left: auto; color: orange !important; font-size: 14px;">
                        公众号：别浪 好好学习
                    </div>
                </div>
            </div>
            
            <!-- 搜索建议下拉框 -->
            <div id="searchSuggestions" class="search-suggestions"></div>
            <table>
                <thead>
                    <tr>
                        <th width="120px">
                            <div class="search-wrapper">
                                <input 
                                    type="text" 
                                    id="searchInput" 
                                    placeholder="股票名称" 
                                    class="search-input"
                                    oninput="showSuggestions(this.value)"
                                >
                            </div>
                        </th>
                        <th>分时图</th>
                        <th>价格</th>
                        <th class="sortable" onclick="sortByChangePercentage()">涨幅</th>
                        <th class="sortable" onclick="sortByAmount()">成交额</th>
                        <th>流通市值</th>
                        <th style="display: none;">代码</th>
                        <th style="display: none;">市场</th>
                        <th class="sortable" onclick="sortByDaysBoards()">几天几板</th>
                        <th>解读</th>
                        <th class="plate-column" style="width: 120px !important; min-width: 120px !important; max-width: 120px !important; padding: 4px !important;">
                            <input type="text" id="plateFilter" placeholder="搜索题材" oninput="filterByPlate(this.value)" class="filter-input">
                        </th>
                    </tr>
                </thead>
                <tbody id="stockTableBody">
                    {% if stocks %}
                        {% for stock in stocks %}
                            <tr onclick="linkToTongDaXin('{{ stock.code_part }}')" style="cursor: pointer;">
                                <td class="stock-name-link{% if stock.code_part.startswith('688') %} blue-text{% elif stock.code_part.startswith('3') or stock.code_part.startswith('68') %} orange-text{% endif %}">{{ stock.name }}</td>
                                <td><div class="time-chart" data-code="{{ stock.code_part }}"></div></td>
                                <td class="price"></td>
                                <td class="change-percentage"></td>
                                <td class="amount"></td>
                                <td class="value"></td>
                                <td style="display: none;" class="{% if stock.code_part.startswith('3') %}orange-code{% endif %}">{{ stock.code_part }}</td>
                                <td style="display: none;">{{ stock.market }}</td>
                                <td>{% if stock.m_days_n_boards %}
                                    <span class="days-boards-tag">{{ stock.m_days_n_boards }}</span>
                                {% else %}{{ stock.m_days_n_boards }}{% endif %}</td>
                                <td>{{ stock.description }}</td>
                                <td class="plate-column">{{ stock.plates }}</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="11" class="no-data">暂无股票数据，请点击"抓取股票数据"按钮获取数据</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        
        <!-- 右侧题材统计表 - 移到container内部 -->
        <div class="sidebar">
            <div class="plate-stats-container">

                <div class="stats-content">
                    <!-- 搜索框和按钮 -->
                    <div class="plate-search-container">
                        <input type="text" id="plateSearchInput" placeholder="搜索所有题材" class="plate-search-input">
                        <button onclick="searchPlate()" class="plate-search-button">GO</button>
                    </div>
                    <table id="plateStatsTable" class="plate-stats-table">
                        <thead class="plate-stats-table th">
                            <tr>
                                <th>题材名称</th>
                                <th>数量</th>
                            </tr>
                        </thead>
                        <tbody id="plateStatsBody">
                            <!-- JavaScript将动态填充统计数据 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 移除数据来源和旋极宝的脚本 -->
    <script>
        // 确保在页面完全加载后移除任何包含"数据来源"或"旋极宝"的元素
        window.addEventListener('load', function() {
            // 查找并移除包含"数据来源"的元素，只检查具体的文本元素，避免删除容器
            const elementsWithDataSource = document.querySelectorAll('p, span, div, td');
            elementsWithDataSource.forEach(element => {
                if (element.textContent && (element.textContent.includes('数据来源') || element.textContent.includes('旋极宝'))) {
                    // 只移除文本内容，不删除整个元素
                    element.textContent = element.textContent.replace('数据来源', '').replace('旋极宝', '');
                }
            });
        });

        function linkToTongDaXin(code) {
            let cleanCode = code;
            if (code.includes('.')) {
                cleanCode = code.split('.')[0];
            }
            const link = `http://www.treeid/code_${cleanCode}`;
            window.location.href = link;
        }
    </script>
    
</body>
</html>